# 模板与格式规范

本文档提供模板占位符、目录结构和输出格式的详细规范。

## 目录

- [模板占位符](#模板占位符)
- [模板目录结构](#模板目录结构)
- [语言检测规则](#语言检测规则)
- [评估维度详解](#评估维度详解)

---

## 模板占位符

### User 模式占位符

| 占位符 | 类型 | 说明 |
|-------|------|------|
| `{{originalPrompt}}` | string | 用户提供的原始提示词 |

### Iterate 模式占位符

| 占位符 | 类型 | 说明 |
|-------|------|------|
| `{{lastOptimizedPrompt}}` | string | 上次优化的提示词 |
| `{{lastEvaluationReport}}` | string | 上次的评估报告 |
| `{{iterateInput}}` | string | 用户的改进指令 |

### 评估模式占位符

| 占位符 | 类型 | 说明 |
|-------|------|------|
| `{{optimizedPrompt}}` | string | 优化后的提示词 |
| `{{reviewReport}}` | string | 深度评审报告 |
| `{{hasOriginalPrompt}}` | boolean | Mustache 条件渲染用 |

---

## 模板目录结构

```
templates/
├── cn/                          # 中文模板
│   ├── user-optimize/           # 新任务优化
│   │   ├── basic.md             # 基础模式
│   │   ├── professional.md      # 专业模式
│   │   └── planning.md          # 规划模式
│   ├── iterate/                 # 迭代优化
│   │   └── general.md           # 通用迭代
│   └── evaluation/              # 评估
│       ├── critical-review.md   # 深度评审
│       └── user.md              # 综合评估
└── en/                          # 英文模板
    └── [结构同上]
```

### 模板路径规则

```
templates/{lang}/{type}/{mode}.md

变量:
- lang: "cn" | "en"
- type: "user-optimize" | "iterate" | "evaluation"
- mode: 具体模式名
```

---

## 语言检测规则

### 检测算法

```python
def detect_language(text: str) -> str:
    # 检查是否包含中文字符 (Unicode 范围: \u4e00-\u9fff)
    if re.search(r'[\u4e00-\u9fff]', text):
        return "cn"
    return "en"
```

### 回退机制

```
1. 尝试加载 templates/{detected_lang}/{type}/{mode}.md
2. 若不存在，回退到 templates/en/{type}/{mode}.md
3. 若仍不存在，报错
```

---

## 评估维度详解

### 维度权重

| 维度 | 权重 | 评估要点 |
|-----|------|---------|
| 任务表达 | 30% | 意图清晰度、目标明确性、范围界定 |
| 信息完整性 | 30% | 关键信息齐全、约束条件明确、上下文充分 |
| 格式规范性 | 20% | 结构层次、可读性、一致性 |
| 改进程度 | 20% | 相比原始的提升、问题解决程度 |

### 评分标准

| 分数区间 | 等级 | 特征描述 |
|---------|------|---------|
| 90-100 | 优秀 | 各维度表现出色，无明显短板 |
| 80-89 | 良好 | 整体优秀，个别维度有提升空间 |
| 70-79 | 中等 | 基本达标，多个维度需要改进 |
| 60-69 | 及格 | 存在明显问题，需要重点优化 |
| 0-59 | 不及格 | 问题严重，建议重新构思 |

### 各维度评分细则

#### 任务表达 (30%)

| 分数 | 标准 |
|-----|------|
| 90-100 | 意图一目了然，目标具体可量化，边界清晰 |
| 70-89 | 意图基本清晰，目标明确但可更具体 |
| 50-69 | 意图模糊，需要推测用户真实需求 |
| 0-49 | 无法确定用户想要什么 |

#### 信息完整性 (30%)

| 分数 | 标准 |
|-----|------|
| 90-100 | 所有必要信息齐全，约束条件明确 |
| 70-89 | 主要信息齐全，部分细节缺失 |
| 50-69 | 关键信息缺失，需要额外假设 |
| 0-49 | 信息严重不足，无法开始工作 |

#### 格式规范性 (20%)

| 分数 | 标准 |
|-----|------|
| 90-100 | 结构清晰，层次分明，易于阅读 |
| 70-89 | 结构合理，个别地方可优化 |
| 50-69 | 结构混乱，需要重新组织 |
| 0-49 | 无结构，难以理解 |

#### 改进程度 (20%)

| 分数 | 标准 |
|-----|------|
| 90-100 | 显著提升，解决了原始提示词的核心问题 |
| 70-89 | 有明显改进，部分问题仍存在 |
| 50-69 | 改进有限，主要问题未解决 |
| 0-49 | 无改进或负面改进 |
