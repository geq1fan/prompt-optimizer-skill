# 完整工作流程

本文档详细说明提示词优化的完整工作流程，包括模板占位符、评估标准和输出格式。

## 模板占位符对照表

| 占位符 | 说明 | 适用场景 |
|-------|------|---------|
| `{{originalPrompt}}` | 用户提供的原始提示词 | user-optimize, system-optimize |
| `{{lastOptimizedPrompt}}` | 上次优化的提示词 | iterate |
| `{{iterateInput}}` | 用户的改进指令 | iterate |
| `{{optimizedPrompt}}` | 优化后的提示词（评估时使用） | evaluation |
| `{{hasOriginalPrompt}}` | 是否存在原始提示词（Mustache 条件） | evaluation |

## 评估维度

### 用户提示词评估（0-100 分）

| 维度 | 权重 | 说明 |
|-----|------|-----|
| 任务表达 | 30% | 是否清晰表达用户意图和任务目标 |
| 信息完整性 | 30% | 关键信息是否齐全，约束条件是否明确 |
| 格式规范性 | 20% | 提示词结构是否清晰易懂 |
| 改进程度 | 20% | 相比原始提示词的提升程度 |

### 系统提示词评估（0-100 分）

| 维度 | 权重 | 说明 |
|-----|------|-----|
| 角色定义 | 25% | 角色身份是否清晰明确 |
| 能力边界 | 25% | 能力范围和限制是否合理 |
| 行为规范 | 25% | 行为准则是否具体可执行 |
| 输出控制 | 25% | 输出格式和风格是否有效控制 |

### 评分参考

| 分数区间 | 等级 | 说明 |
|---------|------|-----|
| 90-100 | 优秀 | 任务清晰、信息完整、格式规范 |
| 80-89 | 良好 | 各方面不错，有明显优势 |
| 70-79 | 中等 | 基本合格，仍有提升空间 |
| 60-69 | 及格 | 存在明显问题，需要优化 |
| 0-59 | 不及格 | 问题严重，需要重写 |

## 输出格式规范

### 优化结果展示

```
## 优化后的提示词

```
[优化后的提示词内容]
```

## 评估报告

- **综合评分**: XX/100
- **任务表达**: XX/100 - [简要说明]
- **信息完整性**: XX/100 - [简要说明]
- **格式规范性**: XX/100 - [简要说明]
- **改进程度**: XX/100 - [简要说明]

**总体评价**: [一句话总结]

## 保存确认

✓ 已保存到 `.prompt_history.jsonl`
```

## 模板目录结构

```
templates/
├── cn/                          # 中文模板
│   ├── user-optimize/          # 用户提示词优化
│   │   ├── basic.md            # 基础优化
│   │   ├── professional.md     # 专业优化
│   │   └── planning.md         # 规划优化
│   ├── system-optimize/        # 系统提示词优化
│   │   ├── general.md          # 通用优化
│   │   └── analytical.md       # 分析型优化
│   ├── iterate/                # 迭代优化
│   │   └── general.md          # 通用迭代
│   └── evaluation/             # 评估模板
│       ├── user.md             # 用户提示词评估
│       └── system.md           # 系统提示词评估
└── en/                          # 英文模板（结构相同）
```

## 语言检测规则

根据用户输入内容自动判断语言：

1. **检测方法**: 检查输入文本中是否包含中文字符
2. **判断逻辑**:
   - 包含中文字符 → 使用 `cn` 目录下的模板
   - 不包含中文字符 → 使用 `en` 目录下的模板
3. **回退机制**: 如果对应语言的模板不存在，回退到英文模板
